
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Overlapping Attributes</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    />

    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        width: 100%;
        top: 0;
        bottom: 0;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>

    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>
    <script>
      // create Leaflet map, centered on Texas
      var map = L.map("map", {
        zoomSnap: 0.1,
        center: [43.317,-124.37996362367487,],
        zoom: 14
      });

      // add a basemap of tiles
      L.tileLayer(
        "https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}.png",
        {
          maxZoom: 18,
          attribution:
            '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy;<a href="https://carto.com/attribution">CARTO</a>'
        }
      ).addTo(map);

      // request our js file


      const ds1 = d3.json("data/ds1.json") // Test Dataset 1 (Simple)
      const ds2 = d3.json("data/ds2.json") // Test Dataset 2 (Simple)

      Promise.all([ds1, ds2]).then(drawMap);

      // d3.json("data/ds1.json").then(function(data) {
      //   drawMap(data, counts);
      // });

      function drawMap(data) {
        // map options
        // console.log(data[0]['features'])
        // // console.log(data[1]['features'][0]['properties'])
        // console.log(data[0]['features'][0]['geometry']['coordinates'],{"test":"test"})
        // var poly1 = turf.polygon(data[0]['features'][0]['geometry']['coordinates'],{"test":"test1"})
        // // console.log(data[0]['geometry'])
        // var poly2 = turf.polygon(data[1]['features'][0]['geometry']['coordinates'])
        // // console.log(poly2)
        // var union = turf.union(poly1, poly2);
        // console.log(union)


        console.log(data[1]['features'])
        let intersectingValues = []
        // Loop through each feature in DS2, collect all intersecting instances of DS1 and save the Name Property //
        // intersectingValues Array
        console.log("Looping through DS2 and checking intersecting values with DS1..")
        for (x of data[1]['features']) {
          console.log(x['properties']['Name'])
          let poly1 = turf.polygon(x['geometry']['coordinates'])
          // Checking Intersecting Values with DS1..
          for (y of data[0]['features']) {
            console.log(y['properties']['Name'])
            let poly2 = turf.polygon(y['geometry']['coordinates'],{"intersectingValue":y['properties']['Name']})
            // let intersection = turf.intersect(poly1, poly2);
            if (turf.intersect(poly1, poly2)) {
              console.log("Found an intersection!")
              // console.log(turf.intersect(poly1, poly2))
              intersectingValues.push(y['properties']['Name'])
            } else {
              console.log("No intersection found..")
            }
          }

        }
        console.log("Final Intersecting Values..");
        console.log(intersectingValues);

        // var multiPoly = turf.multiPolygon(data[0]['features'][0]['geometry']['coordinates'],data[0]['features'][0]['properties'])
        // console.log(multiPoly)

        var options = {
          style: function(feature, layer) {
            return {
              color: "green",
              weight: 2,
              fillColor: "steelblue",
              fillOpacity: .6
            };
          },
          onEachFeature: function(feature, layer) {
            // attach a tooltip to each
            // layer.bindTooltip("# of churches: " + feature.properties.count);
          },
          // filter: function(feature) {
          //   if (feature.properties.count) return feature;
          // }
        };

        // L.geoJSON(data, options).addTo(map);
        // L.geoJSON(union, options).addTo(map);


      }
    </script>
  </body>
</html>
